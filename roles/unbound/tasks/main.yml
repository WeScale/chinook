---
- name: install unbound
  apt:
    name: unbound
    state: present

- template:
    src: local-consul-unbound.conf.j2
    dest: /etc/unbound/unbound.conf.d/local-consul.conf
  notify: restart unbound

- lineinfile:
    path: /etc/resolv.conf
    line: "nameserver 127.0.0.1"
    insertbefore: "^nameserver .*$"

- lineinfile:
    path: /etc/dhcp/dhclient.conf
    regexp: >-
      ^.*prepend domain-name-servers.*$
    line: >-
      prepend domain-name-servers 127.0.0.1;
  notify: restart networking

- service:
    name: unbound
    state: started
    enabled: true

- meta: flush_handlers

